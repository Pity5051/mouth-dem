<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Mouth Overlay Demo</title>
<style>
  body{margin:0;overflow:hidden;font-family:sans-serif}
  #c{position:fixed;top:0;left:0}
</style>
</head>
<body>
  <canvas id="c"></canvas>
  <img id="mouth" src="IMG_3685.png" style="display:none">

  <!-- Librerías Mediapipe -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

  <script>
  /* Si algo falla lo escribimos en rojo */
  function showError(msg){
    document.body.innerHTML='<pre style="color:red;white-space:pre-wrap;padding:1rem">'+msg+'</pre>';
  }

  try{
    /* Elementos */
    const video=document.createElement('video');
    const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');
    const mouth=document.getElementById('mouth');let W=640,H=480;

    /* 1. Cámara */
    navigator.mediaDevices.getUserMedia({video:true}).then(s=>{
      video.srcObject=s;video.play();
      video.onloadedmetadata=()=>{W=canvas.width=video.videoWidth;H=canvas.height=video.videoHeight;};
    }).catch(e=>showError('Permiso cámara denegado: '+e));

    /* 2. FaceMesh */
    const fm=new FaceMesh.FaceMesh({locateFile:f=>'https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/'+f});
    fm.setOptions({maxNumFaces:1});
    fm.onResults(r=>{
      ctx.clearRect(0,0,W,H);
      if(!r.multiFaceLandmarks.length) return;
      const lm=r.multiFaceLandmarks[0],top=lm[13],bot=lm[14];
      const h=Math.hypot((bot.y-top.y)*H,(bot.x-top.x)*W)*2,w=h*1.4,
            x=top.x*W-w/2,y=top.y*H-h/4;
      ctx.drawImage(mouth,x,y,w,h);
    });

    /* 3. Iniciar cámara+detector */
    new Camera(video,{onFrame:async()=>fm.send({image:video})}).start();

  }catch(err){
    showError(err);
  }
  </script>
</body>
</html>
